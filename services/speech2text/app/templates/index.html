<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VistralS2T - Speech-to-Text with AI-Powered Speaker Diarization</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üéôÔ∏è VistralS2T - Speech-to-Text WebUI</h1>
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Ready</span>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Upload & Configuration -->
            <div class="panel config-panel">
                <h2>üì§ Audio Upload</h2>
                
                <!-- Upload Area -->
                <div class="upload-zone" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">Click to upload or drag & drop audio file</div>
                    <div class="upload-subtext">Supports MP3, WAV, M4A, FLAC (Max 500MB)</div>
                    <input type="file" id="fileInput" class="file-input" accept=".mp3,.wav,.m4a,.flac,.ogg">
                </div>

                <!-- File Info -->
                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-name" id="fileName"></div>
                    <div class="file-size" id="fileSize"></div>
                </div>

                <!-- Processing Options -->
                <div class="options-section">
                    <h3>‚öôÔ∏è Processing Options</h3>
                    
                    <div class="form-group">
                        <label>AI Model for Enhancement</label>
                        <select id="modelSelect">
                            <option value="gemini" selected>ü§ñ Gemini (Free, Recommended)</option>
                            <option value="openai">üß† OpenAI GPT-4</option>
                            <option value="deepseek">üî¨ DeepSeek</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableDiarization" checked>
                            Enable Speaker Diarization
                        </label>
                    </div>

                    <div class="form-group">
                        <label>Min Speakers</label>
                        <input type="number" id="minSpeakers" value="2" min="1" max="10">
                    </div>

                    <div class="form-group">
                        <label>Max Speakers</label>
                        <input type="number" id="maxSpeakers" value="5" min="1" max="10">
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="uploadBtn" disabled>
                        üöÄ Start Processing
                    </button>
                    <button class="btn btn-danger" id="stopBtn" disabled>
                        ‚èπÔ∏è Stop
                    </button>
                </div>

                <!-- Cache Management -->
                <div class="cache-section">
                    <h3>üóëÔ∏è Cache Management</h3>
                    <button class="btn btn-secondary btn-small" id="clearCacheBtn">
                        Clear Cache
                    </button>
                    <button class="btn btn-warning btn-small" id="clearServerBtn">
                        Clear Server
                    </button>
                </div>
            </div>

            <!-- Right Panel: Monitoring & Results -->
            <div class="panel monitor-panel">
                <h2>üìä Processing Monitor</h2>

                <!-- Progress Section -->
                <div class="progress-section" id="progressSection" style="display: none;">
                    <div class="progress-info">
                        <span id="currentStep">Initializing...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Duration</div>
                        <div class="metric-value" id="metricDuration">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Speakers</div>
                        <div class="metric-value" id="metricSpeakers">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Segments</div>
                        <div class="metric-value" id="metricSegments">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Processing Time</div>
                        <div class="metric-value" id="metricProcessTime">-</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section" id="chartsSection" style="display: none;">
                    <h3>üìà Model Performance</h3>
                    <div class="chart-container">
                        <canvas id="timingChart"></canvas>
                    </div>
                </div>

                <!-- Results Tabs -->
                <div class="results-section" id="resultsSection" style="display: none;">
                    <h3>üìù Transcription Results</h3>
                    
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchResultTab('timeline')">
                            ‚è±Ô∏è Timeline
                        </button>
                        <button class="tab-btn" onclick="switchResultTab('enhanced')">
                            ‚ú® Enhanced
                        </button>
                    </div>

                    <div class="tab-content active" id="timeline-tab">
                        <div class="transcript-box" id="timelineTranscript"></div>
                    </div>

                    <div class="tab-content" id="enhanced-tab">
                        <div class="transcript-box" id="enhancedTranscript"></div>
                    </div>

                    <!-- Download Buttons -->
                    <div class="download-buttons">
                        <a class="btn btn-download" id="downloadTimeline" href="#" download>
                            üìÑ Download Timeline
                        </a>
                        <a class="btn btn-download" id="downloadEnhanced" href="#" download>
                            ‚ú® Download Enhanced
                        </a>
                        <a class="btn btn-download" id="downloadSegments" href="#" download>
                            üìä Download Segments
                        </a>
                    </div>
                </div>

                <!-- Logs Section -->
                <div class="logs-section">
                    <h3>üìã Processing Logs</h3>
                    <div class="logs-container" id="logsContainer"></div>
                    <div class="logs-controls">
                        <button class="btn-small" onclick="clearLogs()">Clear</button>
                        <label>
                            <input type="checkbox" id="autoScroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>VistralS2T v3.7 - Powered by Whisper, PhoWhisper, Qwen & pyannote.audio</p>
            <p style="font-size: 0.9em; opacity: 0.8;">‚ú® AI-Enhanced Transcription with Real-time Monitoring</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
